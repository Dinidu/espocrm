{
    "beforeSaveCustomScript": "// Opportunity Number\n$fullDate = datetime\\format(datetime\\today(), 'YYYY-MM-DD');\n\n$dateClean = string\\replace($fullDate, '.', '');\n$dateClean = string\\replace($dateClean, '-', '');\n$dateClean = string\\replace($dateClean, '/', '');\n\n$number = cOpportunityID;\nif ($number == null) {\n    $number = 0;\n}\n$incrValue = ($number % 10000) + 1;\n$paddedNumber = string\\pad($incrValue, 5, '0', 'left');\ncOpportunityNumber = string\\concatenate('OP', $dateClean, $paddedNumber);\n\n// //EMI amount calculation\n// $loanAmount = amount; \n// $tenure = cPreferredTenure; \n// $annualRate = cInterestRate;\n\n// $monthlyRate = $annualRate / 12 / 100;\n\n// $temp = 1 + $monthlyRate; \n// $power = $temp; \n// $counter = 1; \n// while ($counter < $tenure) { \n//     $power = $power * $temp; \n//     $counter = $counter + 1; \n// } \n\n// $emi = $loanAmount * $monthlyRate * $power / ($power - 1);\n\n// $emiRounded = number\\round($emi, 2);\n\n// cEmiAmount = $emiRounded;\n\n// //LTV Ratio calculation\n// if (cSecurityValue > 0) {\n//     $calc = (amount / cSecurityValue) * 100;\n\n//     cLtvRatio = number\\round($calc, 2);\n// } else {\n//     cLtvRatio = 0;\n// }\n\n// //Total cost Calculation\n// cTotalLoanCost= (cEmiAmount * cPreferredTenure) + cProcessingFee + cInsurancePremium;\n\n// //Days in pipline\n// cDaysInPipeline = datetime\\diff(datetime\\now(),createdAt, 'days');\n\n// //DTI Calculation\n// ifThen(cDTI == null || cDTI == 0 ,\n// $grossIncome = ifThen(cMonthlyIncome > 0, cMonthlyIncome, 1);\n// $existingEmi = ifThen(cExistingMonthlyObligations == null, 0, cExistingMonthlyObligations);\n\n\n// $dtiRaw = (($existingEmi + cEmiAmount) / $grossIncome) * 100;\n\n// cDTI = number\\round($dtiRaw, 2);\n// );\n\n// //FOIR Calculation\n// ifThen(cFOIR == null || cFOIR == 0 ,\n// $netIncome = ifThen(cMonthlyIncome > 0, cMonthlyIncome, 1);\n\n// $foirRaw = ( cEmiAmount / $netIncome) * 100;\n\n// cFOIR = number\\round($foirRaw, 2);\n// )"
}